<%= render 'layouts/header' %>


<div class="container">

  <% unless @listing.photo_attachments.empty? %>
      <div class="row">
        <div class="col-sm-12">
          <div id="carousel-example-generic" class="carousel slide" data-ride="carousel">
            <!-- Indicators -->
            <% if @listing.photo_attachments.count > 1 %>
                <ol class="carousel-indicators">
                  <% @listing.photo_attachments.each_with_index do |photo_attachment, index| %>
                      <li data-target="#carousel-example-generic"
                          data-slide-to="<%= index %>" class="<%= 'active' if index == 0 %>"></li>
                  <% end %>
                </ol>
            <% end %>

            <!-- Wrapper for slides -->
            <div class="carousel-inner" role="listbox">
              <% @listing.photo_attachments.each_with_index do |photo_attachment, index| %>
                  <div class="item <%= 'active' if index == 0 %>">
                    <%= image_tag photo_attachment.photo.url %>
                  </div>
              <% end %>
            </div>

            <!-- Controls -->
            <% if @listing.photo_attachments.count > 1 %>
                <a class="left carousel-control" href="#carousel-example-generic" role="button" data-slide="prev">
                  <span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>
                  <span class="sr-only">Previous</span>
                </a>
                <a class="right carousel-control" href="#carousel-example-generic" role="button" data-slide="next">
                  <span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>
                  <span class="sr-only">Next</span>
                </a>
            <% end %>
          </div>
        </div>
      </div>

      <br>
      <br>
  <% end %>

  <div class="row">

    <div class="col-md-4">
      <!--Column left-->
      <div class="panel noborder">

        <div class="panel-body">


          <!--List view of Home details-->
          <div class="list-group">
            <a href="#" class="list-group-item list-group-item-action flex-column align-items-start ">
              <div class="d-flex w-100 justify-content-between">
                <h4 class="mb-1">Home Details for 332 Central Park E #5S</h4>
                <small>Updated 3 days ago</small>
                <br>
              </div>
              <p class="mb-1">Description.</p>
              <small>One Bedroom Condo with Private Terrace on tree-lined Park Block. Separate dining area can be
                converted to second bedroom in elegant mint condition. A full service, pet friendly building with gym,
                laundry room, bike room, and parking. Conveniently located to Central Park, Whole Foods shopping and all
                transportation. Ask: $1,188,000 CC+RE TAX $1092 month.
              </small>
            </a>
            <a href="#" class="list-group-item list-group-item-action flex-column align-items-start">
              <div class="d-flex w-100 justify-content-between">
                <h4 class="mb-1">Features of this property</h4>

              </div>


              <p>
              <ul class="list-unstyled">
                <li>
                  3rd Asoyi Ln, Accra, Ghana
                </li>
                <li><span>3</span>bedrooms</li>
                <li>Single-Family Home</li>
                <li>Built in <span>1984</span></li>
                <li>Compound size:<span>19089</span>sqft</li>
              </ul>
              </p>


            </a>
            <a href="#" class="list-group-item list-group-item-action flex-column align-items-start">
              <div class="d-flex w-100 justify-content-between">
                <h4 class="mb-1">Utilities</h4>
                <h5 class="mb-1">Water</h5>

              </div>
              <p class="mb-1">
              <ul class="list-unstyled">
                <li>
                  Available 24hrs a day
                </li>
                <li>Water reservoir: Available</li>
                <li>Water pump:</li>
                <li>Borehole:</li>
                <li>Compound size:<span>19089</span>sqft</li>
              </ul>
              </p>

            </a>
            <a href="#" class="list-group-item list-group-item-action flex-column align-items-start">
              <div class="d-flex w-100 justify-content-between">
                <h5 class="mb-1">Electricity</h5>

              </div>
              <p class="mb-1">
              <ul class="list-unstyled">
                <li>
                  Available 24hrs a day
                </li>
                <li>Backup generator: Available</li>
                <li>Payment: Pre-paid</li>

              </ul>
              </p>

            </a>
            <a href="#" class="list-group-item list-group-item-action flex-column align-items-start">
              <div class="d-flex w-100 justify-content-between">
                <h4 class="mb-1">Amenities </h4>

              </div>
              <p class="mb-1">
              <ul class="list-unstyled">
                <li>
                  Internet: Mtn -3G 500kbs
                </li>
                <li>Garbage Collection: 2 times/week</li>
                <li>Security:</li>

              </ul>
              </p>

            </a>

            <button type="submit" class="btn btn-primary">Request More Information</button>
          </div>

        </div>
      </div>
      <br>


      <!--Map View-->
      <div class="col-md-4">
        <!--Insert Map here-->
      </div>

    </div>


    <!--Column right Model/video/photo view-->
    <div class="col-md-8">

      <div class="row">
        <div class="col-md-12">
          <!-- Nav tabs -->
          <ul class="nav nav-tabs nav-justified" role="tablist">
            <% unless @listing.three_d_models.empty? %>
                <li role="presentation" class="active">
                  <a href="#three_d_models" aria-controls="three_d_models" role="tab" data-toggle="tab">3D Models</a>
                </li>
            <% end %>
            <% unless @listing.three_sixty_videos.empty? %>
                <li role="presentation" class="<%= 'active' if @listing.three_d_models.empty? %>">
                  <a href="#three_sixty_videos" aria-controls="three_sixty_videos" role="tab" data-toggle="tab">360
                    Videos</a></li>
            <% end %>
            <% unless @listing.three_sixty_photos.empty? %>
                <li role="presentation" class="<%= 'active' if @listing.three_sixty_videos.empty? %>">
                  <a href="#three_sixty_photos" aria-controls="three_sixty_photos" role="tab" data-toggle="tab">360
                    Photos</a></li>
            <% end %>
            <li role="presentation" class="<%= 'active' if @listing.three_sixty_photos.empty? %>">
              <a href="#maps" aria-controls="maps" role="tab" data-toggle="tab" id="map-tab">Map</a></li>
          </ul>

          <!-- Tab panes -->
          <div class="tab-content">
            <% unless @listing.three_d_models.empty? %>
                <div role="tabpanel" class="tab-pane active" id="three_d_models">
                  <div class="panel panel-default">
                    <div class="panel-body">
                      <%= raw @listing.three_d_models.first.embed_link %>
                    </div>
                  </div>
                </div>
            <% end %>
            <% unless @listing.three_sixty_videos.empty? %>
                <div role="tabpanel" class="tab-pane <%= 'active' if @listing.three_d_models.empty? %>" id="three_sixty_videos">
                  <div class="panel panel-default">
                    <div class="panel-body">
                      <%= raw @listing.three_sixty_videos.first.embed_link %>
                      <div class="caption">
                        <p>
                        <ul class="list-inline">
                          <li>
                            <%= @listing.address %>
                          </li>
                          <li><span>3</span>bedrooms</li>
                          <li>Single-Family Home</li>
                          <li>Built in <span>1984</span></li>
                          <li>Compound size:<span>19089</span>sqft</li>
                        </ul>
                        </p>
                      </div>
                    </div>
                  </div>
                </div>
            <% end %>
            <% unless @listing.three_sixty_photos.empty? %>
                <div role="tabpanel" class="tab-pane <%= 'active' if @listing.three_sixty_videos.empty? %>" id="three_sixty_photos">
                  <div class="panel panel-default">
                    <div class="panel-body">
                      <%= raw @listing.three_sixty_photos.first.embed_link %>
                    </div>
                  </div>
                </div>
            <% end %>
            <div role="tabpanel" class="tab-pane <%= 'active' if @listing.three_sixty_photos.empty? %>" id="maps">
              <div class="panel panel-default">
                <div class="panel-body">
                  <div id="detail-map"></div>
                  <div class="caption">
                    <div class="caption">
                      <p>
                      <ul class="list-inline">
                        <li>
                          <%= @listing.address %>
                        </li>
                        <li><span>3</span>bedrooms</li>
                        <li>Single-Family Home</li>
                        <li>Built in <span>1984</span></li>
                        <li>Compound size:<span>19089</span>sqft</li>
                      </ul>
                      </p>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="row">
        <div class="col-md-12">
          <h4>See schools, businesses, restaurants and crimes near this home</h4>
        </div>
      </div>

      <div class="row">
        <div class="col-md-12">
          <div class="panel panel-default">
            <div class="panel-body">
              <div id="surroundings-map"></div>
            </div>
          </div>
        </div>
      </div>

      <div class="row">
        <div class="col-md-12">
          <h4>Other listings in this area</h4>
        </div>
      </div>

      <div class="row">
        <% @listings.reverse.take(3).each do |listing| %>
            <div class="col-sm-4 col-md-4">
              <li class="thumbnail">

                <%= link_to listing do %>
                    <%= image_tag listing.photo_attachments.first.photo.url if !listing.photo_attachments.empty? %>
                <% end %>

                <div class="caption">
                  <p>
                    <%= "GHC #{listing.price}, #{listing.address}" %>
                  </p>
                </div>
              </li>
            </div>
        <% end %>
      </div>
    </div>
  </div>
</div>


<script>
    $(document).ready(function () {
        var detailMap = L.map('detail-map').setView([<%= @listing.latitude %>, <%= @listing.longitude %>], 13);

        L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(detailMap);

        L.marker([<%= @listing.latitude %>, <%= @listing.longitude %>]).addTo(detailMap)
            .bindPopup(`
          <%= link_to @listing do %>
            <%= image_tag @listing.photo_attachments.first.photo.url, class: "img-responsive" if !@listing.photo_attachments.empty? %>
          <% end %>

          <div class="caption">
            <%= "GHC #{@listing.price}, #{@listing.listing_name}" %>
          </div>
        `);

        $("body").on("shown.bs.tab", "#map-tab", function () {
            detailMap.invalidateSize(false);
        });

        var surroundingsMap = L.map('surroundings-map').setView([5.6462718, -0.159063], 13);

        L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(surroundingsMap);

        L.marker([5.6462718, -0.159063]).addTo(surroundingsMap)
            .bindPopup(`
          <a href="/listings/1">
            <img class="img-responsive" src="images/kitchen.jpg" alt="Kitchen" />
          </a>
          <div class="caption">
            GHC 300, Room 22 SandCity
          </div>
        `);

    });
</script>